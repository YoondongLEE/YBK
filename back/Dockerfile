FROM python:3.9-slim

WORKDIR /app

# ÏãúÏä§ÌÖú Ìå®ÌÇ§ÏßÄ ÏÑ§Ïπò
RUN apt-get update && apt-get install -y \
    gcc \
    postgresql-client \
    && rm -rf /var/lib/apt/lists/*

# Python ÏùòÏ°¥ÏÑ± ÏÑ§Ïπò
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò ÏΩîÎìú Î≥µÏÇ¨
COPY . .

# Ï†ïÏ†Å ÌååÏùº ÏàòÏßë (ÎπåÎìú ÏãúÏ†ê)
RUN python manage.py collectstatic --noinput

# setup_project.py Ïã§Ìñâ Ïä§ÌÅ¨Î¶ΩÌä∏ (Îü∞ÌÉÄÏûÑ)
RUN echo '#!/bin/bash\n\
set -e\n\
echo "üöÄ Railway Î∞∞Ìè¨ ÏãúÏûë..."\n\
echo "üîß Ï¥àÍ∏∞ ÏÑ§Ï†ï Ïã§Ìñâ..."\n\
python setup_project.py\n\
echo "‚úÖ Ï¥àÍ∏∞ ÏÑ§Ï†ï ÏôÑÎ£å"\n\
echo "üî• ÏÑúÎ≤Ñ ÏãúÏûë..."\n\
exec "$@"' > /app/entrypoint.sh && chmod +x /app/entrypoint.sh

# Ìè¨Ìä∏ ÏÑ§Ï†ï
EXPOSE 8000

ENTRYPOINT ["/app/entrypoint.sh"]
CMD ["gunicorn", "config.wsgi:application", "--bind", "0.0.0.0:8000"]